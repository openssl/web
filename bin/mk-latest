#! /usr/bin/perl -w
use strict;

die "Missing args\n" if $#ARGV < 0;
my $SRCDIR = $ARGV[0]; shift;

chdir $SRCDIR || die "Can't chdir $SRCDIR, $!";

my @tarballs =
       sort grep /openssl-\d+\.\d+\.\d+[a-z]*\.tar\.gz$/,
               glob("openssl-*.tar.gz");

my %series = ();
foreach(@tarballs) {
    my ($version, $serie) =
        /^openssl-(?|(([01]\.\d+\.\d+)[a-z]*)|((\d+\.\d+)\.\d+))\./;
	$series{$serie} = $_;
}
my $latest = $series{ (reverse sort keys %series)[0] };

print <<"EOF";
######################################################################
# Please do NOT edit this file directly!
# Instead, edit bin/mk-latest in the master branch of openssl-web.git
#####

Redirect "/source/latest.tar.gz" "/source/$latest"
EOF

print <<"EOF" foreach (sort keys %series);
Redirect "/source/openssl-$_-latest.tar.gz" "/source/$series{$_}"
EOF
